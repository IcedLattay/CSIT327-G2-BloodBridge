{% load static %}
{% load blood_extras %}

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BloodBridge</title>
  <link rel="stylesheet" href="{% static 'css/header-styles.css' %}">
</head>

<body>

  <header class="site-header">
    <div class="logo">
      <img src="{% static 'images/logo.png' %}" alt="Blood Bridge" />
      <p>BloodBridge</p>
    </div>

    <nav class="nav-links">
      <a class="nav-btn" href="{% url 'home' %}">Home</a>
      <a class="nav-btn" href="{% url 'request-blood' %}">Request</a>
      <a class="nav-btn" href="{% url 'donate-blood' %}">Donate</a>
      

      <div class="dropdown">
        <div class="nav-btn dropbtn" id="dropdown-btn">
          <p>My Records</p>
          <svg class="arrow-icon" id="dropdown-btn-arrow" xmlns="http://www.w3.org/2000/svg" id="Bold"
            viewBox="0 0 24 24">
            <path
              d="M6.414,15.586H17.586a1,1,0,0,0,.707-1.707L12.707,8.293a1,1,0,0,0-1.414,0L5.707,13.879A1,1,0,0,0,6.414,15.586Z" />
          </svg>
        </div>
        <div class="dropdown-content" id="dropdown-content">
          <a href="{% url 'donation_history' %}">Donation History</a>
          <a href="{% url 'request_history' %}">Request History</a>
        </div>
      </div>

      <div class="notification-button">
        <div class="notification-hitbox" id="notification-button"></div>

        <svg class="notification-icon" id="notification-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <g id="_01_align_center" data-name="01 align center">
            <path d="M23.259,16.2l-2.6-9.371A9.321,9.321,0,0,0,2.576,7.3L.565,16.35A3,3,0,0,0,3.493,20H7.1a5,5,0,0,0,9.8,0h3.47a3,3,0,0,0,2.89-3.8ZM12,22a3,3,0,0,1-2.816-2h5.632A3,3,0,0,1,12,22Zm9.165-4.395a.993.993,0,0,1-.8.395H3.493a1,1,0,0,1-.976-1.217l2.011-9.05a7.321,7.321,0,0,1,14.2-.372l2.6,9.371A.993.993,0,0,1,21.165,17.605Z"/>
          </g>
        </svg>
        
        <p class="badge{% if initial_unseen_count %} show{% endif %}">{{ initial_unseen_count }}</p>

        <div class="notification-popup-overlay">
          <svg class="popup-bg" width="342" height="99" viewBox="-10 0 362 130" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M337.014 0.757855C338.95 -0.953556 342 0.42146 342 3.0059V31.3506C342 31.4478 341.994 31.5439 341.985 31.6387C341.994 31.875 342 32.1123 342 32.3506V79.3506C342 89.844 333.493 98.3506 323 98.3506H19C8.50659 98.3506 0 89.844 0 79.3506V32.3506C7.36107e-05 21.8573 8.50664 13.3506 19 13.3506H322.764L337.014 0.757855Z" fill="white"/>
          </svg>
          <div class="popup-message">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24">
              <path d="M1,24c-.552,0-1-.447-1-1V4C0,1.794,1.794,0,4,0H21.998c1.6-.055,2.604,1.958,1.598,3.203l-3.237,4.297,3.237,4.297c1.007,1.245,.003,3.258-1.598,3.203H2v8c0,.553-.448,1-1,1Z"/>
            </svg>
            <p>Blood urgently required!</p>
          </div>
        </div>

        <div class="notification-overlay" id="notification-overlay">
          <p class="notification-label">Notifications</p>
          
          {% if notifications %}
          <div class="notification-list" id="notification-list">

            {% for notif in notifications %}

            {% if notif.type == 'emergency alert' and notif.hospital_request %}

            <div class="notification-item{% if forloop.first %} first{% endif %}" data-id="{{ notif.id }}" data-requestid="{{ notif.hospital_request.id }}">


              <div class="item-header">
                <svg style="fill: red; width: 1rem; height: 1rem;" xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24">
                  <path d="M1,24c-.552,0-1-.447-1-1V4C0,1.794,1.794,0,4,0H21.998c1.6-.055,2.604,1.958,1.598,3.203l-3.237,4.297,3.237,4.297c1.007,1.245,.003,3.258-1.598,3.203H2v8c0,.553-.448,1-1,1Z"/>
                </svg>
                <p class="header-label">Blood urgently required!</p>
                <div class="{% if not notif.is_read %}unread{% endif %}"></div>

              </div>


              <div class="item-hospital">
                <svg style="width: 1.25rem; height: 1.25rem;" viewBox="0 0 27 25">
                  <path d="m15.5 10c0 .551-.448 1-1 1h-1.5v1.5c0 .552-.449 1-1 1s-1-.448-1-1v-1.5h-1.5c-.551 0-1-.449-1-1s.449-1 1-1h1.5v-1.5c0-.551.449-1 1-1s1 .449 1 1v1.5h1.5c.552 0 1 .449 1 1zm6.554.054c0 2.537-1.934 6.49-5.747 11.751-.984 1.373-2.586 2.195-4.281 2.195-1.663.06-3.319-.781-4.341-2.204-3.808-5.254-5.741-9.206-5.741-11.742-.111-5.404 4.651-10.166 10.055-10.054 5.543 0 10.054 4.511 10.055 10.054zm-4.554-.054c0-1.497-1.102-2.74-2.536-2.964-.224-1.435-1.468-2.536-2.964-2.536s-2.74 1.101-2.964 2.536c-1.435.224-2.536 1.468-2.536 2.964s1.101 2.74 2.536 2.964c.224 1.434 1.468 2.536 2.964 2.536s2.74-1.102 2.964-2.536c1.435-.224 2.536-1.468 2.536-2.964z" />
                </svg>
                <p>{{ notif.hospital_request.requester.profile.hospital_name }}</p>
              </div>


              <div class="item-units">
                <svg style="width: 1rem; height: 1rem;" xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24">
                  <path d="m5.5,10.489l-3.889,4.122c-1.039,1.039-1.611,2.42-1.611,3.889s.572,2.851,1.611,3.889c1.039,1.039,2.42,1.611,3.889,1.611s2.85-.572,3.889-1.611c2.145-2.145,2.145-5.634.02-7.758l-3.909-4.142Zm17.028-1.033l-3.528-3.45-3.535,3.458c-1.95,1.95-1.95,5.122,0,7.071.944.944,2.2,1.464,3.535,1.464s2.591-.52,3.536-1.464c1.949-1.95,1.949-5.122-.008-7.079ZM10,.405l-2.828,2.767c-.756.755-1.172,1.76-1.172,2.828s.416,2.073,1.171,2.828c.755.756,1.76,1.172,2.829,1.172s2.073-.416,2.829-1.172c1.56-1.56,1.56-4.097-.008-5.664L10,.405Z"/>
                </svg>
                <p>{{ notif.hospital_request.quantity }} units</p>
              </div>


            </div>

            {% elif notif.type == 'request status' and notif.user_request %}

            <div class="notification-item{% if forloop.first %} first{% endif %}" data-id="{{ notif.id }}">


              <div class="item-header">
                <p class="header-label">Your request has been {{ notif.user_request.status }}!</p>
                <div class="{% if not notif.is_read %}unread{% endif %}"></div>

              </div>


              <div class="item-hospital">
                <svg style="width: 1.25rem; height: 1.25rem;" viewBox="0 0 27 25">
                  <path d="m15.5 10c0 .551-.448 1-1 1h-1.5v1.5c0 .552-.449 1-1 1s-1-.448-1-1v-1.5h-1.5c-.551 0-1-.449-1-1s.449-1 1-1h1.5v-1.5c0-.551.449-1 1-1s1 .449 1 1v1.5h1.5c.552 0 1 .449 1 1zm6.554.054c0 2.537-1.934 6.49-5.747 11.751-.984 1.373-2.586 2.195-4.281 2.195-1.663.06-3.319-.781-4.341-2.204-3.808-5.254-5.741-9.206-5.741-11.742-.111-5.404 4.651-10.166 10.055-10.054 5.543 0 10.054 4.511 10.055 10.054zm-4.554-.054c0-1.497-1.102-2.74-2.536-2.964-.224-1.435-1.468-2.536-2.964-2.536s-2.74 1.101-2.964 2.536c-1.435.224-2.536 1.468-2.536 2.964s1.101 2.74 2.536 2.964c.224 1.434 1.468 2.536 2.964 2.536s2.74-1.102 2.964-2.536c1.435-.224 2.536-1.468 2.536-2.964z" />
                </svg>
                <p>{{ notif.user_request.hospital.profile.hospital_name }}</p>
              </div>


              <div class="item-units">
                <svg style="width: 1rem; height: 1rem;" xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24">
                  <path d="m5.5,10.489l-3.889,4.122c-1.039,1.039-1.611,2.42-1.611,3.889s.572,2.851,1.611,3.889c1.039,1.039,2.42,1.611,3.889,1.611s2.85-.572,3.889-1.611c2.145-2.145,2.145-5.634.02-7.758l-3.909-4.142Zm17.028-1.033l-3.528-3.45-3.535,3.458c-1.95,1.95-1.95,5.122,0,7.071.944.944,2.2,1.464,3.535,1.464s2.591-.52,3.536-1.464c1.949-1.95,1.949-5.122-.008-7.079ZM10,.405l-2.828,2.767c-.756.755-1.172,1.76-1.172,2.828s.416,2.073,1.171,2.828c.755.756,1.76,1.172,2.829,1.172s2.073-.416,2.829-1.172c1.56-1.56,1.56-4.097-.008-5.664L10,.405Z"/>
                </svg>
                <p>{{ notif.user_request.quantity }} units</p>
              </div>


            </div>


            {% elif notif.type == 'appointment reminder' and notif.appointment %}

            <div class="notification-item{% if forloop.first %} first{% endif %}" data-id="{{ notif.id }}">


              <div class="item-header">
                <p class="header-label">You have an appointment</p>
                <div class="{% if not notif.is_read %}unread{% endif %}"></div>

              </div>


              <div class="item-days-left">
                <svg style="width: 1rem; height: 1rem; margin-left: 0.1rem;" xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24">
                  <path d="M12,0C5.383,0,0,5.383,0,12s5.383,12,12,12,12-5.383,12-12S18.617,0,12,0Zm4,13h-4c-.552,0-1-.447-1-1V6c0-.553,.448-1,1-1s1,.447,1,1v5h3c.553,0,1,.447,1,1s-.447,1-1,1Z"/>
                </svg>
                <p>{{ notif.days_left|format_time_left }}</p>
              </div>


              <div class="item-hospital">
                <svg style="width: 1.25rem; height: 1.25rem;" viewBox="0 0 27 25">
                  <path d="m15.5 10c0 .551-.448 1-1 1h-1.5v1.5c0 .552-.449 1-1 1s-1-.448-1-1v-1.5h-1.5c-.551 0-1-.449-1-1s.449-1 1-1h1.5v-1.5c0-.551.449-1 1-1s1 .449 1 1v1.5h1.5c.552 0 1 .449 1 1zm6.554.054c0 2.537-1.934 6.49-5.747 11.751-.984 1.373-2.586 2.195-4.281 2.195-1.663.06-3.319-.781-4.341-2.204-3.808-5.254-5.741-9.206-5.741-11.742-.111-5.404 4.651-10.166 10.055-10.054 5.543 0 10.054 4.511 10.055 10.054zm-4.554-.054c0-1.497-1.102-2.74-2.536-2.964-.224-1.435-1.468-2.536-2.964-2.536s-2.74 1.101-2.964 2.536c-1.435.224-2.536 1.468-2.536 2.964s1.101 2.74 2.536 2.964c.224 1.434 1.468 2.536 2.964 2.536s2.74-1.102 2.964-2.536c1.435-.224 2.536-1.468 2.536-2.964z" />
                </svg>
                <p>{{ notif.appointment.request.requester.profile.hospital_name }} units</p>
              </div>


            </div>

            {% endif %}

            {% endfor %}
          </div>
          
          {% else %}
          <p class="notification-empty">No notifications yet.</p>
          {% endif %}

        </div>
      </div>

      <a href="{% url 'profile' %}" class="profile-icon">
        <img src="{% static user.profile.profile_picture %}" alt="Profile" />
      </a>
    </nav>
  </header>

  <script src="{% static 'js/header.js' %}"></script>

</body>

</html>
